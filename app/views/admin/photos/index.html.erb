<div class = 'col-xs-offset-2 col-xs-10'>
	<h1>Photos</h1>
	<div class = 'col-xs-8'>
		<div class = 'row photos col-xs-12'>
			<% @photos.each do |photo| %>
				<div class = 'col-xs-6 col-md-4'>
					<% if photo.projects.blank? %>
					<%= link_to image_tag photo.picture_url(:thumb).to_s, :class => 'thumbnail' %>
					<%= photo.caption %>
					<% end %>
				</div>
			<% end %>
			<br />
		</div>

		<% @projects.each do |project| %>
		<br />
		<div class = 'row col-xs-12'>
			<h3><%= project.title %></h3>
			<% project.photos.each do |photo| %>
			<div class = 'col-xs-6 col-md-4' %>
			<%= image_tag photo.picture_url(:thumb).to_s, :class => 'thumbnail' %>
			</div>
			<% end %>
		</div>
		<% end %>
	</div>
	<div class = 'side-panel col-xs-3'>
		<h3>Upload Photos</h3>
		<%= simple_form_for @photo, :url => admin_photos_path, :html => {multipart: true} do |f| %>
            <!-- The fileinput-button span is used to style the file input field as button -->
            <span class="btn btn-success fileinput-button">
                <i class="glyphicon glyphicon-plus"></i>
                <span>Add files...</span>
                <%= f.input_field :picture, multiple: true, name: "photo[picture]", :id => 'fileupload' %>
            </span>
		<% end %>
		<br />
		<!-- The container for the uploaded files -->
	    <div id="files" class="files"><p id='water-mark'>Drop files here</p><br/></div>
	    <br />
	    <br />
	    <!-- Button trigger modal -->
		<button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">
		  Add New Photos to Project Gallery
		</button>
		<br />
		<br />
	    <h3>Edit Photos</h3>
	    <%= link_to 'Assign Photos to Project Gallery', edit_multiple_admin_photos_path, :class => 'btn btn-success' %>
	</div>
</div>



<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Upload New Photos to Project Gallery</h4>
      </div>
		<%= simple_form_for @photo , :url => admin_photos_path, :html => {multipart: true} do |f| %>
      <div class="modal-body">
			<br />

			<b>Select files to upload</b><br /><br />	
			<%= f.file_field :picture, multiple: true, name: "photo[picture]", id: 'new_picture' %><br />
			<b>Add to Project(s)</b><br>
			<%= f.collection_check_boxes :project_ids, @projects, :id, :title, include_hidden: false %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <%= f.submit 'Upload Photos', :class => 'btn btn-primary' %>

      </div>
      		<% end %>	
    </div>
  </div>
</div>

<script id="template-upload" type="text/xtmpl">
	<div class="upload">
	{%=o.name%}
	    <div class="progress">
	  		<div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
	    	<span class="sr-only">Complete (success)</span>
	  		</div>
		</div>
	</div>
</script>

<script>
$(function () {
	$(document).on('dragover', function (event) {
		$('#files').css({
			"border": "5px dotted black"
		});
		$('#water-mark').css({
			"opacity": "1"
		});
	});
	$(document).on('dragleave', function (event) {
		$('#files').css({
			"border": "5px dotted #CCCCCC"
		});
		$('#water-mark').css({
			"opacity": "0.5"
		});
	})

	$('#fileupload').fileupload({
		dataType: 'script',
		acceptFileTypes: /(\.|\/)(gif|jpe?g|png)$/i,
		add: function (e, data) {
			data.context = $(tmpl("template-upload", data.files[0]));
			$('#files').append(data.context);
        	data.submit();
		},
		progressall: function (e, data) {
			var progress = parseInt(data.loaded / data.total * 100, 10);
        	$('.progress-bar').css('width', progress + '%');
        	if (progress == 100) {
        		$('.upload').fadeOut('slow');
        	}
        }
	});
})
</script>